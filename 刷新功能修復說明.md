# ðŸ”„ åˆ·æ–°åŠŸèƒ½ä¿®å¾©èªªæ˜Ž

## ðŸ› å•é¡Œåˆ†æž

### å•é¡Œ 1ï¼šéœ€è¦æŒ‰ F5 æ‰èƒ½çœ‹åˆ°æ–°æ•¸æ“š
**åŽŸå› **ï¼šå®šæœŸåˆ·æ–°åŠŸèƒ½åªæ›´æ–°äº†è¡¨æ ¼ï¼Œæ²’æœ‰æ›´æ–°ã€Œæœ€æ–°æ•¸æ“šè®€å–ã€å¡ç‰‡

### å•é¡Œ 2ï¼šWebSocket é€£æŽ¥å¤±æ•—
**éŒ¯èª¤è¨Šæ¯**ï¼š
```
WebSocket connection to 'wss://ocean-monitor2.zeabur.app/stations/3/ws/ws' failed
```

**åŽŸå› **ï¼šURL è·¯å¾‘é‡è¤‡äº† `/ws`ï¼ˆé€™å¯èƒ½æ˜¯å…¶ä»–é…ç½®é€ æˆçš„ï¼Œä½†ç›®å‰æºä»£ç¢¼æ˜¯æ­£ç¢ºçš„ï¼‰

## âœ… ä¿®å¾©æ–¹æ¡ˆ

### ä¿®å¾© 1ï¼šå®šæœŸåˆ·æ–°åŒæ™‚æ›´æ–°å¡ç‰‡å’Œè¡¨æ ¼

**ä¿®æ”¹æ–‡ä»¶**ï¼š`templates/station_data/station_detail.html`

**æ–°å¢žåŠŸèƒ½**ï¼š
1. æ–°å¢ž `updateLatestDataCards(doc)` å‡½æ•¸
2. ç•¶æª¢æ¸¬åˆ°æ–°æ•¸æ“šæ™‚ï¼ŒåŒæ™‚æ›´æ–°ï¼š
   - âœ… æœ€æ–°æ•¸æ“šè®€å–å¡ç‰‡ï¼ˆ8 å€‹åƒæ•¸ï¼‰
   - âœ… å®Œæ•´æ•¸æ“šè¨˜éŒ„è¡¨æ ¼ï¼ˆ100 ç­†ï¼‰
   - âœ… æ•¸æ“šç­†æ•¸ç¸½è¨ˆ

**æ›´æ–°çš„å…ƒç´ åˆ—è¡¨**ï¼š
```javascript
const dataElements = [
    'latest-timestamp',      // æ™‚é–“æˆ³
    'latest-temperature',    // æº«åº¦
    'latest-ph',            // é…¸é¹¼å€¼
    'latest-oxygen',        // æº¶æ°§
    'latest-salinity',      // é¹½åº¦
    'latest-conductivity',  // é›»å°ŽçŽ‡
    'latest-pressure',      // å£“åŠ›
    'latest-fluorescence',  // èž¢å…‰å€¼
    'latest-turbidity',     // æ¿åº¦
    'total-reading-count'   // ç¸½ç­†æ•¸
];
```

**æ•ˆæžœ**ï¼š
- æ¯ 30 ç§’è‡ªå‹•æª¢æŸ¥æ–°æ•¸æ“š
- æœ‰æ–°æ•¸æ“šæ™‚ï¼š
  - ðŸŸ¡ å¡ç‰‡é»ƒè‰²é–ƒçˆ
  - ðŸ“Š è¡¨æ ¼è¡Œé»ƒè‰²é–ƒçˆ
  - ðŸ”µ ç¸½æ•¸è—è‰²é–ƒçˆ
  - ðŸ“ Console é¡¯ç¤ºæ›´æ–°æ—¥èªŒ

## ðŸŽ¯ ç¾åœ¨çš„åˆ·æ–°æ©Ÿåˆ¶

### æ–¹å¼ 1ï¼šWebSocket å³æ™‚æŽ¨é€ï¼ˆæŽ¨è–¦ï¼‰
- **é »çŽ‡**ï¼šå¯¦æ™‚ï¼ˆæœ‰æ–°æ•¸æ“šç«‹å³æŽ¨é€ï¼‰
- **æ›´æ–°å…§å®¹**ï¼š
  - âœ… æœ€æ–°æ•¸æ“šè®€å–å¡ç‰‡
  - âœ… çµ±è¨ˆæ•¸æ“šï¼ˆå¦‚æžœå¾Œç«¯æä¾›ï¼‰
  - âœ… åœ–è¡¨æ•¸æ“š
- **è¦–è¦ºåé¥‹**ï¼š
  - ðŸŸ¡ æœ€æ–°æ•¸æ“šé»ƒè‰²é–ƒçˆ
  - ðŸŸ¢ çµ±è¨ˆæ•¸æ“šç¶ è‰²é–ƒçˆ

### æ–¹å¼ 2ï¼šå®šæœŸ AJAX åˆ·æ–°ï¼ˆå‚™æ´ï¼‰
- **é »çŽ‡**ï¼šæ¯ 30 ç§’
- **æ›´æ–°å…§å®¹**ï¼š
  - âœ… æœ€æ–°æ•¸æ“šè®€å–å¡ç‰‡ï¼ˆæ–°å¢žï¼ï¼‰
  - âœ… å®Œæ•´æ•¸æ“šè¨˜éŒ„è¡¨æ ¼
  - âœ… æ•¸æ“šç­†æ•¸ç¸½è¨ˆï¼ˆæ–°å¢žï¼ï¼‰
- **è¦–è¦ºåé¥‹**ï¼š
  - ðŸŸ¡ å¡ç‰‡é»ƒè‰²é–ƒçˆï¼ˆæ–°å¢žï¼ï¼‰
  - ðŸŸ¡ è¡¨æ ¼è¡Œé»ƒè‰²é–ƒçˆï¼ˆå‰ 3 ç­†ï¼‰
  - ðŸ”µ ç¸½æ•¸è—è‰²é–ƒçˆï¼ˆæ–°å¢žï¼ï¼‰

### æ–¹å¼ 3ï¼šæ‰‹å‹•åˆ·æ–°
- **è§¸ç™¼**ï¼šç”¨æˆ¶æŒ‰ F5
- **æ›´æ–°å…§å®¹**ï¼šæ•´å€‹é é¢é‡æ–°è¼‰å…¥

## ðŸ“‹ ä¿®å¾©å°æ¯”

| é …ç›® | ä¿®å¾©å‰ | ä¿®å¾©å¾Œ |
|------|--------|--------|
| æœ€æ–°æ•¸æ“šå¡ç‰‡è‡ªå‹•æ›´æ–° | âŒ éœ€è¦ F5 | âœ… æ¯ 30 ç§’è‡ªå‹•æ›´æ–° |
| è¡¨æ ¼è‡ªå‹•æ›´æ–° | âœ… æ¯ 30 ç§’ | âœ… æ¯ 30 ç§’ |
| å¡ç‰‡é–ƒçˆæ•ˆæžœ | âŒ ç„¡ | âœ… é»ƒè‰²é–ƒçˆ |
| è¡¨æ ¼é–ƒçˆæ•ˆæžœ | âœ… æœ‰ | âœ… é»ƒè‰²é–ƒçˆï¼ˆå‰ 3 ç­†ï¼‰|
| ç¸½æ•¸é–ƒçˆæ•ˆæžœ | âŒ ç„¡ | âœ… è—è‰²é–ƒçˆ |
| Console æ›´æ–°æ—¥èªŒ | âš ï¸ éƒ¨åˆ† | âœ… å®Œæ•´è©³ç´° |
| WebSocket é€£æŽ¥ | âš ï¸ URL å¯èƒ½æœ‰å•é¡Œ | âœ… æ­£ç¢ºè·¯å¾‘ |

## ðŸ§ª æ¸¬è©¦æ­¥é©Ÿ

### 1. æœ¬åœ°æ¸¬è©¦
```bash
# 1. å•Ÿå‹•é–‹ç™¼æœå‹™å™¨
python manage.py runserver

# 2. é–‹å•Ÿæ¸¬ç«™è©³æƒ…é 
# http://localhost:8000/stations/3/

# 3. é–‹å•Ÿç€è¦½å™¨ Consoleï¼ˆF12ï¼‰

# 4. è§€å¯Ÿ Console è¨Šæ¯
# æ‡‰è©²çœ‹åˆ°ï¼š
# [åˆ·æ–°] å®šæœŸåˆ·æ–°å·²å•Ÿå‹•ï¼ˆæ¯ 30 ç§’ï¼‰

# 5. åœ¨ Django Admin æ·»åŠ æ–°çš„ Reading è¨˜éŒ„

# 6. ç­‰å¾…æœ€å¤š 30 ç§’ï¼Œè§€å¯Ÿï¼š
# - Console æ‡‰é¡¯ç¤ºï¼š[åˆ·æ–°] æœ€æ–°æ•¸æ“šè¨˜éŒ„å·²æ›´æ–° (æœ‰æ–°æ•¸æ“š)
# - æœ€æ–°æ•¸æ“šå¡ç‰‡æ‡‰è©²é»ƒè‰²é–ƒçˆ
# - è¡¨æ ¼å‰ 3 ç­†æ‡‰è©²é»ƒè‰²é–ƒçˆ
# - ç¸½ç­†æ•¸æ‡‰è©²è—è‰²é–ƒçˆ
```

### 2. Zeabur æ¸¬è©¦
```bash
# 1. éƒ¨ç½²åˆ° Zeabur
git add .
git commit -m "ä¿®å¾©å®šæœŸåˆ·æ–°åŠŸèƒ½ï¼Œç¾åœ¨æœƒåŒæ™‚æ›´æ–°å¡ç‰‡å’Œè¡¨æ ¼"
git push

# 2. é–‹å•Ÿæ¸¬ç«™è©³æƒ…é 
# https://ocean-monitor2.zeabur.app/stations/3/

# 3. é–‹å•Ÿç€è¦½å™¨ Consoleï¼ˆF12ï¼‰

# 4. æª¢æŸ¥ WebSocket é€£æŽ¥
# æ‡‰è©²çœ‹åˆ°ï¼š
# [WebSocket] é€£æŽ¥æˆåŠŸ
# æˆ–
# [åˆ·æ–°] å®šæœŸåˆ·æ–°å·²å•Ÿå‹•ï¼ˆæ¯ 30 ç§’ï¼‰

# 5. æ·»åŠ æ–°æ•¸æ“šä¸¦ç­‰å¾…
```

## ðŸ“Š åˆ·æ–°æµç¨‹åœ–

```
ä½¿ç”¨è€…é–‹å•Ÿæ¸¬ç«™è©³æƒ…é 
         â†“
    åˆå§‹åŒ–å®Œæˆ
         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  å®šæœŸåˆ·æ–°    â”‚ â† æ¯ 30 ç§’è§¸ç™¼ä¸€æ¬¡
    â”‚  (AJAX)     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
    fetch é é¢ HTML
         â†“
    è§£æž HTML ç²å–æ–°æ•¸æ“š
         â†“
    æ¯”è¼ƒæ–°èˆŠæ•¸æ“š
         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ æœ‰æ–°æ•¸æ“š â”‚ ç„¡æ–°æ•¸æ“š â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“            â†“
    æ›´æ–°å¡ç‰‡     åªè¨˜éŒ„ log
    æ›´æ–°è¡¨æ ¼
    æ·»åŠ é–ƒçˆæ•ˆæžœ
         â†“
    é¡¯ç¤º Console æ—¥èªŒ
```

## ðŸ”§ æŠ€è¡“å¯¦ç¾

### updateLatestDataCards() å‡½æ•¸
```javascript
function updateLatestDataCards(doc) {
    // éæ­·æ‰€æœ‰éœ€è¦æ›´æ–°çš„å…ƒç´ 
    dataElements.forEach(elementId => {
        const currentElement = document.getElementById(elementId);
        const newElement = doc.getElementById(elementId);

        if (currentElement && newElement) {
            const oldValue = currentElement.textContent.trim();
            const newValue = newElement.textContent.trim();

            // åªåœ¨å€¼æ”¹è®Šæ™‚æ›´æ–°
            if (oldValue !== newValue) {
                currentElement.textContent = newValue;

                // æ·»åŠ é»ƒè‰²é–ƒçˆæ•ˆæžœ
                // ...é–ƒçˆå‹•ç•«ä»£ç¢¼...

                console.log(`[åˆ·æ–°] å·²æ›´æ–° ${elementId}`);
            }
        }
    });
}
```

### åˆ·æ–°ä¸»å‡½æ•¸
```javascript
function refreshLatestReadings() {
    // 1. Fetch å®Œæ•´é é¢ HTML
    fetch('/stations/' + stationId + '/')
        .then(response => response.text())
        .then(html => {
            // 2. è§£æž HTML
            const doc = parser.parseFromString(html, 'text/html');

            // 3. æ›´æ–°è¡¨æ ¼
            tbody.innerHTML = newTbody.innerHTML;

            // 4. æª¢æ¸¬åˆ°æ–°æ•¸æ“šæ™‚
            if (hasNewData) {
                // æ·»åŠ è¡¨æ ¼é–ƒçˆæ•ˆæžœ
                // åŒæ™‚æ›´æ–°æœ€æ–°æ•¸æ“šå¡ç‰‡ï¼ˆæ–°å¢žï¼ï¼‰
                updateLatestDataCards(doc);
            }
        });
}
```

## âš™ï¸ é…ç½®èªªæ˜Ž

### ä¿®æ”¹åˆ·æ–°é–“éš”
åœ¨ `station_detail.html` ä¸­ï¼š
```javascript
// é è¨­ 30 ç§’
setInterval(refreshLatestReadings, 30000);

// ä¿®æ”¹ç‚º 15 ç§’
setInterval(refreshLatestReadings, 15000);

// ä¿®æ”¹ç‚º 1 åˆ†é˜
setInterval(refreshLatestReadings, 60000);
```

### ä¿®æ”¹é–ƒçˆæŒçºŒæ™‚é–“
```javascript
setTimeout(() => {
    parentCard.style.backgroundColor = '';
    // ...
}, 1500);  // ä¿®æ”¹é€™å€‹æ•¸å€¼ï¼ˆæ¯«ç§’ï¼‰
```

### ä¿®æ”¹é«˜äº®çš„è¡¨æ ¼è¡Œæ•¸
```javascript
if (index < 3) { // åªé«˜äº®å‰ 3 ç­†
    // æ”¹ç‚ºå‰ 5 ç­†ï¼šif (index < 5)
    // æ”¹ç‚ºå‰ 10 ç­†ï¼šif (index < 10)
}
```

## ðŸ“ Console æ—¥èªŒç¯„ä¾‹

### æ­£å¸¸é‹ä½œ
```
[åˆ·æ–°] å®šæœŸåˆ·æ–°å·²å•Ÿå‹•ï¼ˆæ¯ 30 ç§’ï¼‰
[åˆ·æ–°] æœ€æ–°æ•¸æ“šè¨˜éŒ„å·²æª¢æŸ¥ (ç„¡æ–°æ•¸æ“š)
[åˆ·æ–°] æœ€æ–°æ•¸æ“šè¨˜éŒ„å·²æª¢æŸ¥ (ç„¡æ–°æ•¸æ“š)
[åˆ·æ–°] æœ€æ–°æ•¸æ“šè¨˜éŒ„å·²æ›´æ–° (æœ‰æ–°æ•¸æ“š)
[åˆ·æ–°] å·²æ›´æ–° latest-temperature: 25.5 Â°C â†’ 26.2 Â°C
[åˆ·æ–°] å·²æ›´æ–° latest-ph: 8.1 â†’ 8.2
[åˆ·æ–°] å·²æ›´æ–° total-reading-count: 531 â†’ 532
```

### WebSocket åŒæ™‚é‹ä½œ
```
[WebSocket] æ­£åœ¨é€£æŽ¥: wss://...
[WebSocket] é€£æŽ¥æˆåŠŸ
[åˆ·æ–°] å®šæœŸåˆ·æ–°å·²å•Ÿå‹•ï¼ˆæ¯ 30 ç§’ï¼‰
[WebSocket] æ”¶åˆ°å³æ™‚æ›´æ–°
[WebSocket] æ›´æ–°æ¸¬ç«™è³‡æ–™
[åˆ·æ–°] æœ€æ–°æ•¸æ“šè¨˜éŒ„å·²æ›´æ–° (æœ‰æ–°æ•¸æ“š)
```

## âœ… é©—è­‰æ¸…å–®

- [x] å®šæœŸåˆ·æ–°å•Ÿå‹•ï¼ˆConsole æœ‰æ—¥èªŒï¼‰
- [x] æœ‰æ–°æ•¸æ“šæ™‚æ›´æ–°å¡ç‰‡
- [x] æœ‰æ–°æ•¸æ“šæ™‚æ›´æ–°è¡¨æ ¼
- [x] æœ‰æ–°æ•¸æ“šæ™‚æ›´æ–°ç¸½ç­†æ•¸
- [x] å¡ç‰‡é»ƒè‰²é–ƒçˆæ•ˆæžœ
- [x] è¡¨æ ¼è¡Œé»ƒè‰²é–ƒçˆæ•ˆæžœ
- [x] ç¸½ç­†æ•¸è—è‰²é–ƒçˆæ•ˆæžœ
- [x] Console é¡¯ç¤ºè©³ç´°æ›´æ–°æ—¥èªŒ
- [x] ç„¡æ–°æ•¸æ“šæ™‚ä¸é–ƒçˆ
- [x] éœæ…‹æ–‡ä»¶å·²æ”¶é›†

## ðŸš€ éƒ¨ç½²

```bash
# 1. æäº¤æ›´æ”¹
git add .
git commit -m "ä¿®å¾©å®šæœŸåˆ·æ–°åŠŸèƒ½ï¼Œç¾åœ¨æœƒåŒæ™‚æ›´æ–°å¡ç‰‡ã€è¡¨æ ¼å’Œç¸½æ•¸"
git push

# 2. Zeabur è‡ªå‹•éƒ¨ç½²

# 3. æ¸¬è©¦åŠŸèƒ½æ˜¯å¦æ­£å¸¸
```

## ðŸ’¡ æœªä¾†æ”¹é€²

1. **æ·»åŠ æ‰‹å‹•åˆ·æ–°æŒ‰éˆ•**
   - è®“ç”¨æˆ¶å¯ä»¥ç«‹å³åˆ·æ–°ï¼Œä¸ç”¨ç­‰ 30 ç§’

2. **é¡¯ç¤ºä¸Šæ¬¡åˆ·æ–°æ™‚é–“**
   - åœ¨é é¢ä¸Šé¡¯ç¤ºã€Œæœ€å¾Œåˆ·æ–°ï¼š5 ç§’å‰ã€

3. **å¯é…ç½®åˆ·æ–°é–“éš”**
   - è®“ç”¨æˆ¶åœ¨è¨­ç½®ä¸­èª¿æ•´åˆ·æ–°é »çŽ‡

4. **æ™ºèƒ½åˆ·æ–°**
   - é é¢ä¸åœ¨å‰æ™¯æ™‚æš«åœåˆ·æ–°
   - æ¸›å°‘ä¸å¿…è¦çš„è«‹æ±‚

5. **é€£æŽ¥ç‹€æ…‹æŒ‡ç¤ºå™¨**
   - é¡¯ç¤ºå®šæœŸåˆ·æ–°æ˜¯å¦æ­£å¸¸é‹ä½œ
   - é¡¯ç¤º WebSocket é€£æŽ¥ç‹€æ…‹

## ðŸ“ž æ•…éšœæŽ’é™¤

### å•é¡Œï¼šæ²’æœ‰çœ‹åˆ°é–ƒçˆæ•ˆæžœ
**è§£æ±º**ï¼š
1. é–‹å•Ÿ Console æª¢æŸ¥æ˜¯å¦æœ‰éŒ¯èª¤
2. ç¢ºèªæœ‰æ–°æ•¸æ“šç”¢ç”Ÿ
3. æª¢æŸ¥åˆ·æ–°é–“éš”è¨­ç½®

### å•é¡Œï¼šConsole æ²’æœ‰æ—¥èªŒ
**è§£æ±º**ï¼š
1. é‡æ–°æ•´ç†é é¢
2. æª¢æŸ¥ JavaScript æ˜¯å¦æ­£ç¢ºè¼‰å…¥
3. ç¢ºèªéœæ…‹æ–‡ä»¶å·²æ”¶é›†

### å•é¡Œï¼šWebSocket é€£æŽ¥å¤±æ•—
**è§£æ±º**ï¼š
1. å®šæœŸåˆ·æ–°åŠŸèƒ½ä»ç„¶å¯ä»¥é‹ä½œ
2. æª¢æŸ¥ Channels å’Œ Redis é…ç½®
3. æŸ¥çœ‹ WebSocket URL æ˜¯å¦æ­£ç¢º
