{% extends 'base.html' %}

{% block title %}å°è¦½è¨­å®š - æµ·æ´‹ç›£æ¸¬ç³»çµ±{% endblock %}

{% block content %}
<div class="card">
    <h2>ğŸ“ å°è¦½æ•™å­¸è¨­å®š</h2>

    <div style="margin-bottom: 2rem;">
        <p style="color: #666; margin-bottom: 1rem;">
            ç®¡ç†ç¶²é å°è¦½æ•™å­¸çš„é¡¯ç¤ºåå¥½è¨­å®š
        </p>
    </div>

    <div class="settings-section">
        <h3 style="font-size: 1.2rem; margin-bottom: 1rem; color: #2c3e50;">è‡ªå‹•å°è¦½</h3>

        <div class="setting-item">
            <label class="switch">
                <input type="checkbox" id="autoTourToggle" onchange="handleAutoTourToggle(this)">
                <span class="slider"></span>
            </label>
            <div class="setting-info">
                <strong>é¦–æ¬¡è¨ªå•æ™‚è‡ªå‹•å•Ÿå‹•å°è¦½</strong>
                <p style="color: #666; font-size: 0.9rem; margin-top: 0.3rem;">
                    ç•¶æ‚¨ç¬¬ä¸€æ¬¡è¨ªå•æŸå€‹é é¢æ™‚ï¼Œç³»çµ±æœƒè‡ªå‹•å•Ÿå‹•äº’å‹•å¼å°è¦½æ•™å­¸ã€‚
                </p>
            </div>
        </div>
    </div>

    <div class="settings-section" style="margin-top: 2rem;">
        <h3 style="font-size: 1.2rem; margin-bottom: 1rem; color: #2c3e50;">å°è¦½é€²åº¦</h3>

        <div class="progress-info">
            <p style="margin-bottom: 1rem;">
                æ‚¨å·²å®Œæˆä»¥ä¸‹é é¢çš„å°è¦½æ•™å­¸ï¼š
            </p>
            <ul id="completedTours" style="list-style: none; padding: 0;">
                <!-- JavaScript å‹•æ…‹å¡«å…… -->
            </ul>
        </div>

        <button onclick="resetAllTours()" class="btn btn-warning" style="margin-top: 1rem;">
            é‡ç½®æ‰€æœ‰å°è¦½é€²åº¦
        </button>
    </div>

    <div class="settings-section" style="margin-top: 2rem;">
        <h3 style="font-size: 1.2rem; margin-bottom: 1rem; color: #2c3e50;">å¿«é€Ÿå•Ÿå‹•</h3>

        <p style="color: #666; margin-bottom: 1rem;">
            é»æ“Šå°èˆªæ¬„å³ä¸Šè§’çš„ã€Œâ“ æ•™å­¸ã€æŒ‰éˆ•å¯ä»¥éš¨æ™‚é‡æ–°å•Ÿå‹•ç•¶å‰é é¢çš„å°è¦½æ•™å­¸ã€‚
        </p>
    </div>
</div>

<style>
.settings-section {
    border-top: 1px solid #eee;
    padding-top: 1.5rem;
}

.setting-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: #f8f9fa;
    border-radius: 8px;
}

.setting-info {
    flex: 1;
}

/* Toggle Switch */
.switch {
    position: relative;
    display: inline-block;
    width: 60px;
    height: 34px;
}

.switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: .4s;
    border-radius: 34px;
}

.slider:before {
    position: absolute;
    content: "";
    height: 26px;
    width: 26px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    transition: .4s;
    border-radius: 50%;
}

input:checked + .slider {
    background-color: #667eea;
}

input:checked + .slider:before {
    transform: translateX(26px);
}

.btn {
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
}

.btn-warning {
    background: #f39c12;
    color: white;
}

.btn-warning:hover {
    background: #e67e22;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(243, 156, 18, 0.3);
}

.progress-info ul li {
    padding: 0.5rem;
    margin-bottom: 0.5rem;
    background: #e8f5e9;
    border-left: 3px solid #4caf50;
    border-radius: 4px;
}
</style>

<script>
// è¼‰å…¥ç•¶å‰è¨­å®š
document.addEventListener('DOMContentLoaded', function() {
    // æª¢æŸ¥è‡ªå‹•å°è¦½è¨­å®š
    const autoTourDisabled = localStorage.getItem('auto_tour_disabled');
    const toggle = document.getElementById('autoTourToggle');
    toggle.checked = autoTourDisabled !== 'true';

    // é¡¯ç¤ºå·²å®Œæˆçš„å°è¦½
    loadCompletedTours();
});

function handleAutoTourToggle(checkbox) {
    if (checkbox.checked) {
        localStorage.removeItem('auto_tour_disabled');
        alert('å·²å•Ÿç”¨è‡ªå‹•å°è¦½ï¼é¦–æ¬¡è¨ªå•é é¢æ™‚å°‡è‡ªå‹•é¡¯ç¤ºå°è¦½æ•™å­¸ã€‚');
    } else {
        localStorage.setItem('auto_tour_disabled', 'true');
        alert('å·²ç¦ç”¨è‡ªå‹•å°è¦½ã€‚æ‚¨ä»å¯ä»¥é»æ“Šã€Œâ“ æ•™å­¸ã€æŒ‰éˆ•æ‰‹å‹•å•Ÿå‹•å°è¦½ã€‚');
    }
}

function loadCompletedTours() {
    const keys = Object.keys(localStorage).filter(key => key.startsWith('tour_completed_'));
    const completedList = document.getElementById('completedTours');

    if (keys.length === 0) {
        completedList.innerHTML = '<li style="background: #fff3cd; border-left-color: #ffc107;">å°šæœªå®Œæˆä»»ä½•å°è¦½æ•™å­¸</li>';
        return;
    }

    const pageNames = {
        '/': 'é¦–é ',
        '/stations/': 'æ¸¬ç«™åˆ—è¡¨',
        '/stations/readings/': 'æ•¸æ“šè¨˜éŒ„',
        '/stations/reports/': 'å ±å‘Šç®¡ç†'
    };

    completedList.innerHTML = keys.map(key => {
        const path = key.replace('tour_completed_', '');
        const pageName = pageNames[path] || path;
        return `<li>âœ“ ${pageName}</li>`;
    }).join('');
}

function resetAllTours() {
    if (!confirm('ç¢ºå®šè¦é‡ç½®æ‰€æœ‰å°è¦½é€²åº¦å—ï¼Ÿä¸‹æ¬¡è¨ªå•æ™‚å°‡å†æ¬¡é¡¯ç¤ºå°è¦½æ•™å­¸ã€‚')) {
        return;
    }

    const keys = Object.keys(localStorage).filter(key => key.startsWith('tour_completed_'));
    keys.forEach(key => localStorage.removeItem(key));

    alert('å°è¦½é€²åº¦å·²é‡ç½®ï¼');
    loadCompletedTours();
}
</script>
{% endblock %}
